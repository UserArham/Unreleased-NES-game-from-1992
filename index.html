<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NES Simulator (C++ / WASM)</title>
  <style>
    body { background:#111; color:#eee; font-family:sans-serif; text-align:center; }
    canvas { image-rendering: pixelated; border:2px solid #555; }
  </style>
</head>
<body>

<h1>NES Simulator (C++ Core)</h1>
<p>Kirby Prototype Environment</p>

<canvas id="screen" width="256" height="240"></canvas><br><br>
<button onclick="nesReset()">Reset</button>

<script src="nes.js"></script>
<script>
  const canvas = document.getElementById("screen");
  const ctx = canvas.getContext("2d");
  const imageData = ctx.createImageData(256, 240);

  Module.onRuntimeInitialized = () => {
    Module._nes_init();
    requestAnimationFrame(loop);
  };

  function loop() {
    Module._nes_step();

    const fb = Module.HEAPU8.subarray(
      Module._nes_framebuffer(),
      Module._nes_framebuffer() + (256 * 240 * 4)
    );

    imageData.data.set(fb);
    ctx.putImageData(imageData, 0, 0);
    requestAnimationFrame(loop);
  }

  function nesReset() {
    Module._nes_reset();
  }
</script>

</body>
</html>
